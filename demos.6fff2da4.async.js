"use strict";(self.webpackChunkreact_client_print=self.webpackChunkreact_client_print||[]).push([[433],{92501:function(rn,ve,r){r.r(ve),r.d(ve,{default:function(){return an}});var Ne=r(15009),j=r.n(Ne),be=r(19632),_=r.n(be),Fe=r(99289),D=r.n(Fe),Ae=r(97857),f=r.n(Ae),fe=r(99659),Pe=r(75081),ee=r(27790),w=r(46670),m=r(67294),Ze=r(94184),he=r.n(Ze),O=r(68949),Ee=(0,m.createContext)({}),z=Ee,we=r(9783),E=r.n(we),Be=r(5574),te=r.n(Be),De=r(13769),Oe=r.n(De),ze=r(55961),$e=r.n(ze),Me=r(92592),Le=r(68496),ie=r.n(Le),i=r(85893),$=10,ke=function(t,e){var a=t%$,n=t;a<5?n=Math.floor(t/$)*$:n=Math.ceil(t/$)*$;var l=e%$,o=e;return l<5?o=Math.floor(e/$)*$:o=Math.ceil(e/$)*$,{left:n,top:o}},Re=function(t){var e=t.children,a=t.position,n=t.node,l=t.onChange,o=t.options,d=t.isActive,v=t.onChangeActive,A=t.enableAutoAlign,N=(0,m.useRef)(null);(0,m.useLayoutEffect)(function(){var y=ie()(N.current).draggable({listeners:{move:function(c){var F=c.target,Z=F.parentNode,V=Z.clientWidth,W=Z.clientHeight,U=W-c.rect.height,H=V-c.rect.width,L=parseFloat(F.style.top)+c.dy,K=parseFloat(F.style.left)+c.dx;L=Math.max(L,0),L=Math.min(L,U),K=Math.max(K,0),K=Math.min(K,H),F.style.top="".concat(L,"px"),F.style.left="".concat(K,"px")},end:function(c){var F=c.target,Z=parseFloat(F.style.left),V=parseFloat(F.style.top),W=A?ke(Z,V):{left:Z,top:V},U=W.left,H=W.top;F.style.top="".concat(H,"px"),F.style.left="".concat(U,"px"),l&&l({top:H,left:U})}}}),u=o||{},h=u.ratio,C=[ie().modifiers.restrictSize({min:{width:10,height:10}})];if(h){var G=ie().modifiers.aspectRatio({ratio:h});C.push(G)}y.resizable({edges:{bottom:!0,right:!0},margin:3,modifiers:C}).on("resizemove",function(P){var c=P.target.parentNode,F=c.clientWidth,Z=c.clientHeight,V=P.rect,W=V.width,U=V.height,H=parseFloat(P.target.style.top)+P.deltaRect.top,L=parseFloat(P.target.style.left)+P.deltaRect.left,K=Z-U,ln=F-W;H>=0&&H<=K&&Object.assign(P.target.style,{height:"".concat(U,"px"),top:"".concat(H,"px")}),L>=0&&L<=ln&&Object.assign(P.target.style,{width:"".concat(W,"px"),left:"".concat(L,"px")})}).on("resizeend",function(P){l&&l({width:parseFloat(P.rect.width),height:parseFloat(P.rect.height)})})}),(0,m.useLayoutEffect)(function(){var y=a.left,u=a.width,h=a.top,C=a.height,G=a.style;Object.assign(N.current.style,f()({left:"".concat(y,"px"),top:"".concat(h,"px"),width:"".concat(u,"px"),height:"".concat(C,"px")},G))},[a]);var B=(0,m.useState)(!1),g=te()(B,2),T=g[0],x=g[1],S=function(u){l&&l(f()(f()({},n),{},{placeholder:u.target.value})),x(!1)},p=function(u){u.key==="Enter"&&S(u)},b=function(){n&&n.type==="label"&&x(!0)},M=function(){v&&n&&v(n)};return(0,i.jsx)("div",{ref:N,className:"label-style",style:f()(f()(f()({position:"absolute",border:"1px solid #eaeaea",display:"flex",alignItems:"center",wordBreak:"break-all"},a),a.style),{},{backgroundColor:d?"#FFF566":void 0}),onDoubleClick:b,onClick:M,children:T&&d&&n?(0,i.jsx)("input",{className:"input-style",defaultValue:n.placeholder,onBlur:S,onKeyPress:p,onDragStart:function(u){return u.stopPropagation()},style:{outline:"none"}}):e})},Ie=Re,Ge=function(t){var e=t.style,a=t.offsetTop,n=t.position,l=t.children;return(0,i.jsx)("div",{style:f()(f()({display:"flex",transform:"translate(".concat(n.left,"px,").concat(n.top-a,"px)"),alignItems:"center",wordBreak:"break-all"},n),e||{}),children:l})},He=Ge,Je=["mode","children","style","offsetTop"];function pe(s,t,e){var a=document.createElement("canvas");try{var n=s;t==="EAN8"?n=n.slice(0,7):t==="EAN13"?n=n.slice(0,12):t==="UPC"&&(n=n.slice(0,11)),$e()(a,n,{margin:0,displayValue:!1,format:t,flat:!0})}catch(l){e?e(t||"CODE128"):ee.ZP.error("\u6761\u5F62\u7801\u6587\u5B57\u4E0D\u7B26\u5408\u6761\u4EF6\uFF01")}return a.toDataURL("image/png")}var le=function(t){var e=t.mode,a=t.children,n=t.style,l=t.offsetTop,o=Oe()(t,Je);return e==="edit"?(0,i.jsx)(Ie,f()(f()({},o),{},{children:a})):(0,i.jsx)(He,{style:n,offsetTop:l,position:o.position,children:a})},Ve=function(t){var e=t.mode,a=t.template,n=t.onChange,l=t.activeNode,o=t.onChangeActive,d=t.enableRulerGuide,v=t.enableAutoAlign,A=t.style,N=t.className,B=a||{},g=B.size,T=g===void 0?{}:g,x=B.nodes,S=x===void 0?[]:x,p=S.find(function(c){return c.type==="barcode"}),b=S.find(function(c){return c.type==="qrcode"}),M=(0,m.useMemo)(function(){return e==="edit"?pe("barcode"):(p==null?void 0:p.placeholder)&&pe(p==null?void 0:p.placeholder,p==null?void 0:p.formmat)},[p==null?void 0:p.placeholder,p==null?void 0:p.formmat,e]),y=(0,m.useState)(""),u=te()(y,2),h=u[0],C=u[1];(0,m.useEffect)(function(){var c={errorCorrectionLevel:"L",type:"image/png",quality:.1,margin:0,color:{dark:"#000"}};Me.toDataURL((b==null?void 0:b.placeholder)||"default",c,function(F,Z){if(F)throw F;C(Z)})},[b==null?void 0:b.placeholder]);var G=0,P=function(F){var Z=G;return G+=F,Z};return(0,i.jsx)("div",{className:he()("typography-card-container",E()({isEditing:e==="edit"&&d,isNotEditing:e!=="edit"},N,!!N)),style:f()(f()({},A),{},{width:"".concat(T==null?void 0:T.width,"mm"),height:"".concat(T==null?void 0:T.height,"mm")}),children:S.map(function(c){return c.type==="label"||c.type==="value"?(0,i.jsx)(le,{mode:e,position:c,node:c,isActive:l&&c.id===l.id,onChange:function(Z){Object.assign(c,Z),n&&n(a)},onChangeActive:o,style:c.style,enableAutoAlign:v,offsetTop:P(c.height||0),children:c.placeholder},c.id):c.type==="barcode"?(0,i.jsx)(le,{mode:e,position:c,onChange:function(Z){Object.assign(c,Z),n&&n(a)},enableAutoAlign:v,offsetTop:P(c.height||0),children:(0,i.jsx)("div",{className:"qrcode-wrapper",children:(0,i.jsx)("img",{src:M,alt:c.placeholder})})},c.id):c.type==="qrcode"?(0,i.jsx)(le,{mode:e,position:c,onChange:function(Z){Object.assign(c,Z),n&&n(a)},options:{ratio:1},enableAutoAlign:v,offsetTop:P(c.height||0),children:(0,i.jsx)("div",{className:"qrcode-wrapper",children:(0,i.jsx)("img",{src:h,alt:c.placeholder})})},c.id):null})})},me=(0,w.Pi)(Ve),We=function(){var t=(0,m.useContext)(z),e=t.store,a=e.mode==="display"?e.replacedTemplate:e.edtingTemplate;return(0,i.jsx)("div",{className:"print-preview-container",children:!!a&&(0,i.jsx)(me,{style:{margin:"0 auto"},mode:e.mode,template:a,activeNode:e.activeNode,onChangeActive:function(l){return e.updateNode({activeNode:l})},enableRulerGuide:e.enableRulerGuide,enableAutoAlign:e.enableAutoAlign})})},Ue=(0,w.Pi)(We),k=r(48755),ge=r(20554),Q=r(26713),ye=r(76306),R=r(71577),I=r(87939),xe=r(39004),Te=r(38980),Ke=I.Z.Item,Qe=function(){var t=(0,m.useContext)(z),e=t.store,a=I.Z.useForm(),n=te()(a,1),l=n[0],o=function(){l.validateFields().then(function(v){e.createTemplate(v),e.update({addTemplateModalVisible:!1}),l.resetFields()})};return(0,i.jsx)(xe.Z,{closable:!0,destroyOnClose:!0,title:"\u65B0\u589E\u6253\u5370\u6A21\u677F",open:e.addTemplateModalVisible,onOk:o,onCancel:function(){return e.update({addTemplateModalVisible:!1})},okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",children:(0,i.jsx)(I.Z,{form:l,children:(0,i.jsx)(Ke,{colon:!1,label:"\u6A21\u677F\u540D\u79F0",name:"name",rules:[{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{validator:function(v,A){var N,B=(N=e.templates)===null||N===void 0?void 0:N.find(function(g){return g.name===A});return B?Promise.reject(new Error("\u6A21\u677F\u540D\u79F0\u91CD\u590D")):Promise.resolve()}}],children:(0,i.jsx)(Te.Z,{placeholder:"\u8BF7\u8F93\u5165",onPressEnter:function(){return o()}})})})})},Ye=(0,w.Pi)(Qe),Xe=r(68839),Y=r(53229),ne=r(96486),qe=I.Z.Item,_e=function(t){var e=t.visible,a=t.onOk,n=t.onCancel,l=I.Z.useForm(),o=te()(l,1),d=o[0],v=function(){d.validateFields().then(function(N){a(N)})};return(0,i.jsx)(xe.Z,{open:e,title:"\u6DFB\u52A0\u5B57\u6BB5",closable:!0,maskClosable:!0,onOk:v,onCancel:n,okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",children:(0,i.jsx)(I.Z,{form:d,style:{width:"100%"},children:(0,i.jsx)(qe,{label:"\u65B0\u589E\u5B57\u6BB5",colon:!1,name:"newField",rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,i.jsx)(Te.Z,{autoFocus:!0,placeholder:"\u8BF7\u8F93\u5165",style:{width:"100%"},onPressEnter:v})})})})},et=function(){var t=(0,m.useContext)(z),e=t.store;return(0,O.EH)(function(){console.log("store-->",e.deleteFieldBtnDisabled,(0,O.ZN)(e))}),(0,i.jsxs)("div",{className:"fields-container",children:[(0,i.jsxs)(Q.Z,{size:16,align:"center",style:{justifyContent:"space-around",width:"100%"},children:[(0,i.jsx)(R.ZP,{size:"small",type:"dashed",style:{width:120},onClick:function(){e.update({addLabelModalVisible:!0})},children:"\u6DFB\u52A0\u5B57\u6BB5"}),e.deleteFieldBtnDisabled?(0,i.jsx)(Xe.Z,{placement:"top",title:"\u8BF7\u5148\u5728\u6253\u5370\u9875\u9762\u4E2D\u9009\u4E2D\u8981\u5220\u9664\u7684\u5B57\u6BB5",children:(0,i.jsx)(R.ZP,{type:"dashed",className:"disabled-btn",size:"small",style:{width:120},children:"\u5220\u9664\u5B57\u6BB5"})}):(0,i.jsx)(ye.Z,{title:"\u4F60\u786E\u5B9A\u5220\u9664\u5F53\u524D\u9009\u4E2D\u7684\u5B57\u6BB5\u5417\uFF1F",okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",onConfirm:function(){return e.removeNode(e.activeNode.placeholder,!0)},children:(0,i.jsx)(R.ZP,{type:"dashed",size:"small",style:{width:120},children:"\u5220\u9664\u5B57\u6BB5"})})]}),e.addLabelModalVisible&&(0,i.jsx)(_e,{visible:e.addLabelModalVisible,onOk:function(n){e.addNode(n.newField,"label"),e.update({addLabelModalVisible:!1})},onCancel:function(){return e.update({addLabelModalVisible:!1})}}),e.fieldsGroup.map(function(a){return(0,i.jsxs)("div",{className:"field-group",children:[(0,i.jsx)("div",{className:"field-group-name",children:a.name}),(0,i.jsx)(Y.Z.Group,{value:a.value,onChange:function(l){if(console.log("checkedValue",l),a.value.length!==l.length)if(a.value.length>l.length){var o,d=(0,ne.difference)(a.value,l)[0];e.removeNode("{".concat(d,"}"),((o=e.activeNode)===null||o===void 0?void 0:o.placeholder)===d)}else{var v=(0,ne.difference)(l,a.value)[0];e.addNode("{".concat(v,"}"),"value")}},children:(0,i.jsx)(Q.Z,{size:8,wrap:!0,children:a.fields.map(function(n){return(0,i.jsx)(Y.Z,{value:n,children:n},n)})})})]},a.name)})]})},tt=(0,w.Pi)(et),re=r(88385),nt=I.Z.Item,at=function(){var t=(0,m.useContext)(z),e=t.store,a=e.edtingTemplate||{},n=a.size;return(0,i.jsxs)(nt,{label:"\u5C3A\u5BF8",colon:!1,children:[(0,i.jsx)(re.Z,{size:"small",min:1,max:300,addonAfter:"mm",style:{width:100},value:n==null?void 0:n.width,onChange:(0,O.aD)(function(l){Object.assign(e.edtingTemplate.size,{width:l})})}),(0,i.jsx)("span",{style:{color:"rgba(0, 0, 0, .2)",margin:"0 4px"},children:"\u2716\uFE0F"}),(0,i.jsx)(re.Z,{size:"small",min:1,max:300,value:n==null?void 0:n.height,style:{width:100},addonAfter:"mm",onChange:(0,O.aD)(function(l){Object.assign(e.edtingTemplate.size,{height:l})})})]})},it=(0,w.Pi)(at),lt=r(8139),rt=r(37734),ot=r(30026),st=r(82972),dt=r(74563),ut=r(87577),Ce=r(33573),je=r(72269),X=I.Z.Item,oe=k.Z.Option,ct=[{name:"\u6D4F\u89C8\u5668\u9ED8\u8BA4",value:"inherit"},{name:"\u5FAE\u8F6F\u96C5\u9ED1",value:"\u5FAE\u8F6F\u96C5\u9ED1"},{name:"Arial",value:"Arial"}],vt=[{component:(0,i.jsx)(lt.Z,{}),value:"flex-start"},{component:(0,i.jsx)(rt.Z,{}),value:"center"},{component:(0,i.jsx)(ot.Z,{}),value:"flex-end"}],ft=[{name:"\u65E0\u8FB9\u6846",value:"none"},{name:"\u5B9E\u7EBF\u6846",value:"1px solid #aaa"},{name:"\u865A\u7EBF\u6846",value:"1px dashed #aaa"}],ht=function(){var t,e,a,n,l,o,d,v,A,N,B=(0,m.useContext)(z),g=B.store,T=((t=g.activeNode)===null||t===void 0?void 0:t.style)||{},x=T.fontFamily,S=x===void 0?"inherit":x,p=T.justifyContent,b=T.border,M=b===void 0?"none":b,y=function(h){var C,G=f()(f()({},g.activeNode),{},{style:f()(f()({},(C=g.activeNode)===null||C===void 0?void 0:C.style),h)});g.updateNode({activeNode:G})};return(0,i.jsxs)(Q.Z,{size:10,direction:"vertical",children:[(0,i.jsxs)(X,{label:"\u5B57\u4F53",colon:!1,className:"font-form-item",children:[(0,i.jsx)(k.Z,{disabled:g.fontStyleDisabled,size:"small",value:S,style:{width:"100%"},onChange:function(h){return y({fontFamily:h})},children:ct.map(function(u){return(0,i.jsx)(oe,{value:u.value,children:u.name},u.value)})}),(0,i.jsxs)("div",{className:"font-stye-and-font-size",children:[(0,i.jsxs)(Y.Z.Group,{value:(0,ne.compact)([(e=g.activeNode)===null||e===void 0||(a=e.style)===null||a===void 0?void 0:a.fontWeight,(n=g.activeNode)===null||n===void 0||(l=n.style)===null||l===void 0?void 0:l.fontStyle,(o=g.activeNode)===null||o===void 0||(d=o.style)===null||d===void 0?void 0:d.textDecoration]),disabled:g.fontStyleDisabled,onChange:function(h){return y({fontStyle:h!=null&&h.includes("italic")?"italic":void 0,textDecoration:h!=null&&h.includes("underline")?"underline":void 0,fontWeight:h!=null&&h.includes("bold")?"bold":void 0})},children:[(0,i.jsx)(Y.Z,{value:"bold",children:(0,i.jsx)(st.Z,{})}),(0,i.jsx)(Y.Z,{value:"italic",children:(0,i.jsx)(dt.Z,{})}),(0,i.jsx)(Y.Z,{value:"underline",children:(0,i.jsx)(ut.Z,{})})]}),(0,i.jsx)(k.Z,{disabled:g.fontStyleDisabled,size:"small",value:String((v=(A=g.activeNode)===null||A===void 0||(N=A.style)===null||N===void 0?void 0:N.fontSize)!==null&&v!==void 0?v:14),style:{width:66},onChange:function(h){return y({fontSize:h})},children:Array(16).fill(1).map(function(u,h){return{name:h+7}}).map(function(u){return(0,i.jsx)(oe,{value:u.name,children:u.name},u.name)})})]})]}),(0,i.jsx)(X,{label:"\u5BF9\u9F50",colon:!1,children:(0,i.jsx)(Ce.ZP.Group,{disabled:g.fontStyleDisabled,defaultValue:"flex-start",size:"small",value:p,onChange:function(h){return y({justifyContent:h.target.value})},children:vt.map(function(u){return(0,i.jsx)(Ce.ZP.Button,{value:u.value,children:u.component},u.value)})})}),(0,i.jsx)(X,{label:"\u8FB9\u6846",children:(0,i.jsx)(k.Z,{disabled:g.fontStyleDisabled,size:"small",value:M,onChange:function(h){return y({border:h})},children:ft.map(function(u){return(0,i.jsx)(oe,{value:u.value,children:u.name},u.name)})})}),(0,i.jsx)(X,{label:"\u8F85\u52A9\u7EBF",children:(0,i.jsx)(je.Z,{size:"small",checked:g.enableRulerGuide,onChange:function(h){g.update({enableRulerGuide:h})}})}),(0,i.jsx)(X,{label:"\u81EA\u52A8\u5BF9\u9F50",children:(0,i.jsx)(je.Z,{size:"small",checked:g.enableAutoAlign,onChange:function(h){return g.update({enableAutoAlign:h})}})})]})},pt=(0,w.Pi)(ht),mt=k.Z.Option,se=ge.Z.Panel,gt=function(){var t,e,a=(0,m.useContext)(z),n=a.store;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"print-setting-edit",children:[(0,i.jsxs)(Q.Z,{size:16,align:"center",className:"select-template-container",children:[(0,i.jsx)(k.Z,{showSearch:!0,allowClear:!0,style:{width:176},placeholder:"\u8BF7\u9009\u62E9\u6A21\u677F",value:(t=n.selectedTemplate)===null||t===void 0?void 0:t.name,onChange:function(o){return n.switchTemplate(o)},children:(e=n.templates)===null||e===void 0?void 0:e.map(function(l){return(0,i.jsx)(mt,{value:l.name,children:l.name},l.name)})}),(0,i.jsx)("a",{onClick:function(){return n.update({addTemplateModalVisible:!0})},children:"\u65B0\u589E"}),(0,i.jsx)(ye.Z,{placement:"topLeft",title:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u6A21\u677F\u5417\uFF1F",onConfirm:n.deleteTemplate,okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",children:(0,i.jsx)("a",{children:"\u5220\u9664"})})]}),(0,i.jsxs)(ge.Z,{defaultActiveKey:["pageSize","style","fields"],children:[(0,i.jsx)(se,{header:"\u6253\u5370\u53CA\u7EB8\u5F20\u8BBE\u7F6E",children:(0,i.jsx)(it,{})},"pageSize"),(0,i.jsx)(se,{header:"\u6837\u5F0F",children:(0,i.jsx)(pt,{})},"style"),(0,i.jsx)(se,{header:"\u5B57\u6BB5",children:(0,i.jsx)(tt,{})},"fields")]}),(0,i.jsx)(Ye,{})]}),(0,i.jsxs)(Q.Z,{className:"fixed-footer",children:[(0,i.jsx)(R.ZP,{type:"dashed",onClick:function(){n.update({edtingTemplate:f()(f()({},n.edtingTemplate),{},{nodes:[]})})},children:"\u6E05\u7A7A"}),(0,i.jsx)(R.ZP,{onClick:function(){n.update({mode:"display",edtingTemplate:void 0})},children:"\u8FD4\u56DE"}),(0,i.jsx)(R.ZP,{type:"primary",onClick:D()(j()().mark(function l(){return j()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,n.updateTemplate();case 2:n.update({mode:"display"});case 3:case"end":return d.stop()}},l)})),children:"\u4FDD\u5B58"})]})]})},yt=(0,w.Pi)(gt),xt=r(28818),Tt=r(41133),Ct=r(71230),q=r(15746),jt=r(96074),St=k.Z.Option,Nt=function(){var t,e=(0,m.useContext)(z),a=e.store;return(0,i.jsxs)("div",{className:"print-setting-show",children:[(0,i.jsx)(xt.Z,{style:{color:"#dadada",fontSize:86}}),(0,i.jsx)("div",{className:"print-label",children:"\u6253\u5370"}),(0,i.jsxs)(Ct.Z,{gutter:[8,16],style:{padding:"0 16px"},align:"middle",children:[(0,i.jsx)(q.Z,{span:6,children:"\u6253\u5370\u6A21\u677F"}),(0,i.jsx)(q.Z,{span:12,children:(0,i.jsx)(k.Z,{showSearch:!0,style:{width:"100%"},placeholder:"\u9009\u62E9\u6A21\u7248",value:(t=a.selectedTemplate)===null||t===void 0?void 0:t.name,onChange:function(l){return a.switchTemplate(l)},children:(a.templates||[]).map(function(n){return(0,i.jsx)(St,{value:n.name,children:n.name},n.name)})})}),(0,i.jsx)(q.Z,{span:6,children:(0,i.jsx)(Tt.Z,{style:{color:"#006FFF",fontSize:"18px",marginLeft:"8px"},onClick:function(){return a.update({mode:"edit",edtingTemplate:(0,O.ZN)(a.selectedTemplate)})}})}),(0,i.jsx)(q.Z,{span:6,children:"\u6253\u5370\u4EFD\u6570"}),(0,i.jsx)(q.Z,{span:12,children:(0,i.jsx)(re.Z,{style:{width:"100%"},addonAfter:"\u4EFD",min:1,max:100,value:a.numberOfCopies,onChange:function(l){return a.update({numberOfCopies:l})}})})]}),(0,i.jsx)(jt.Z,{}),(0,i.jsxs)(Q.Z,{size:16,children:[(0,i.jsx)(R.ZP,{onClick:function(){return history.back()},children:"\u53D6\u6D88"}),(0,i.jsx)(R.ZP,{type:"primary",onClick:function(){return window.print()},disabled:!a.selectedTemplate,children:"\u6253\u5370"})]})]})},bt=(0,w.Pi)(Nt),Ft=function(){var t=(0,m.useContext)(z),e=t.store;return(0,i.jsx)("div",{className:"print-setting-container",children:e.mode==="edit"?(0,i.jsx)(yt,{}):(0,i.jsx)(bt,{})})},At=(0,w.Pi)(Ft),Pt=r(73935),J=document.getElementById("window-print-root");J?J.innerHTML="":(J=document.createElement("div"),J.id="window-print-root",document.body.append(J));var Zt=function(){var t,e=(0,m.useContext)(z),a=e.store,n=document.createElement("div");(0,m.useEffect)(function(){var o;return(o=J)===null||o===void 0||o.appendChild(n),function(){var d;(d=J)===null||d===void 0||d.removeChild(n)}});var l=(0,i.jsx)("table",{className:"print-style",children:(0,i.jsx)("tr",{children:(0,i.jsx)("td",{children:(t=a.printDataSource)===null||t===void 0?void 0:t.map(function(o,d){return(0,i.jsx)(me,{template:o},d)})})})});return Pt.createPortal(l,n)},Et=(0,w.Pi)(Zt),wt=r(12444),Bt=r.n(wt),Dt=r(72004),Ot=r.n(Dt),zt=function(t){var e=t.size?t.size:void 0;if(e){var a=`
    @media print {
      @page {
        size: `.concat(e.width,"mm  ").concat(e.height,`mm;
      }
    }
    `),n=document.body.querySelector("#print-style");n?n.innerHTML=a:(n=document.createElement("style"),n.id="print-style",n.innerHTML=a,document.body.append(n))}},$t=function(){function s(){Bt()(this,s),E()(this,"mode","display"),E()(this,"numberOfCopies",1),E()(this,"templates",[]),E()(this,"edtingTemplate",void 0),E()(this,"selectedTemplate",void 0),E()(this,"dataSource",[]),E()(this,"defaultFields",[]),E()(this,"customFields",[]),E()(this,"activeNode",void 0),E()(this,"enableRulerGuide",!0),E()(this,"enableAutoAlign",!0),E()(this,"addTemplateModalVisible",!1),E()(this,"onChange",void 0),E()(this,"addLabelModalVisible",!1),(0,O.ky)(this,{},{autoBind:!0})}return Ot()(s,[{key:"update",value:function(e){Object.assign(this,e)}},{key:"fields",get:function(){return(0,ne.flatten)([this.defaultFields,this.customFields])}},{key:"replacedTemplate",get:function(){if(this.selectedTemplate){var e,a=(e=this.dataSource)===null||e===void 0?void 0:e[0];return this.mergeTemplateWithData(this.selectedTemplate,a)}}},{key:"fontStyleDisabled",get:function(){var e,a;return!this.activeNode||((e=this.activeNode)===null||e===void 0?void 0:e.type)!=="label"&&((a=this.activeNode)===null||a===void 0?void 0:a.type)!=="value"}},{key:"deleteFieldBtnDisabled",get:function(){var e,a;return!(((e=this.activeNode)===null||e===void 0?void 0:e.type)==="label"||((a=this.activeNode)===null||a===void 0?void 0:a.type)==="value")}},{key:"fieldsGroup",get:function(){var e,a=(((e=this.edtingTemplate)===null||e===void 0?void 0:e.nodes)||[]).filter(function(l){return l.type!=="label"}),n=a.map(function(l){return l.placeholder.slice(1,-1)});return(this.defaultFields||[]).map(function(l){return{name:l.name,fields:l.fields,value:n.filter(function(o){return l.fields.includes(o)})}})}},{key:"updateNode",value:function(e){var a;this.update({activeNode:e.activeNode,edtingTemplate:f()(f()({},this.edtingTemplate),{},{nodes:(((a=this.edtingTemplate)===null||a===void 0?void 0:a.nodes)||[]).map(function(n){var l;return n.id===((l=e.activeNode)===null||l===void 0?void 0:l.id)?e.activeNode:n})})})}},{key:"addNodeToEditingTemplate",value:function(e){var a;this.update({edtingTemplate:f()(f()({},this.edtingTemplate),{},{nodes:[].concat(_()(((a=this.edtingTemplate)===null||a===void 0?void 0:a.nodes)||[]),[e])})})}},{key:"addNode",value:function(e,a){if(e.includes("\u4E8C\u7EF4\u7801"))this.addNodeToEditingTemplate({id:"qrcode",type:"qrcode",placeholder:e,top:50,left:0,width:112,height:112});else if(e.includes("\u6761\u5F62\u7801"))this.addNodeToEditingTemplate({id:"barcode",top:0,left:0,width:106,height:19,type:"barcode",placeholder:e});else{var n=(0,O.LO)({id:Date.now(),type:a,placeholder:e,top:0,left:0,height:32,width:112,style:{fontSize:14}});this.addNodeToEditingTemplate(n)}}},{key:"removeNode",value:function(e,a){var n,l;this.update({activeNode:a?void 0:this.activeNode,edtingTemplate:f()(f()({},this.edtingTemplate),{},{nodes:((n=this.edtingTemplate)===null||n===void 0||(l=n.nodes)===null||l===void 0?void 0:l.filter(function(o){return o.placeholder!==e}))||[]})})}},{key:"createTemplate",value:function(e){this.onChange&&this.onChange({template:e,operationType:"create"})}},{key:"deleteTemplate",value:function(){var t=D()(j()().mark(function a(){var n,l;return j()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!this.onChange){d.next=4;break}return d.next=3,this.onChange({template:this.selectedTemplate,operationType:"delete"});case 3:((n=this.edtingTemplate)===null||n===void 0?void 0:n.name)===((l=this.selectedTemplate)===null||l===void 0?void 0:l.name)&&this.update({edtingTemplate:void 0,selectedTemplate:void 0});case 4:case"end":return d.stop()}},a,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"updateTemplate",value:function(){var t=D()(j()().mark(function a(){return j()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.onChange){l.next=3;break}return l.next=3,this.onChange({template:this.edtingTemplate,operationType:"update"});case 3:case"end":return l.stop()}},a,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"switchTemplate",value:function(e){var a=this.templates.find(function(n){return n.name===e});this.update({selectedTemplate:a,edtingTemplate:(0,O.ZN)(a)})}},{key:"mergeTemplateWithData",value:function(e,a){var n,l=[];return(n=e.nodes)===null||n===void 0||n.forEach(function(o){var d,v;if(o.type==="label"){l.push(o);return}l.push(f()(f()({},o),{},{placeholder:a==null||(d=a[(v=o.placeholder)===null||v===void 0?void 0:v.slice(1,-1)])===null||d===void 0?void 0:d.toString()}))}),f()(f()({},e),{},{nodes:l})}},{key:"printDataSource",get:function(){var e=this;if(this.selectedTemplate){zt(this.selectedTemplate);var a=[];return this.dataSource.forEach(function(n){for(var l=0;l<e.numberOfCopies;l+=1)a.push(e.mergeTemplateWithData(e.selectedTemplate,n))}),a||[]}}}]),s}(),Mt=$t,Lt=function(t){var e=t.dataSource,a=t.templates,n=t.defaultTemplateName,l=t.defaultFields,o=t.onChange,d=t.ref,v=(0,m.useMemo)(function(){return new Mt},[]);(0,m.useImperativeHandle)(d,function(){return{store:v}},[v]),(0,m.useEffect)(function(){console.log("JSON.stringify(templates)",(0,O.ZN)(a)),v==null||v.update({dataSource:e,templates:a,defaultFields:l})},[JSON.stringify(e),JSON.stringify(a),JSON.stringify(l)]);var A=v.templates.find(function(B){return B.name===n});(0,m.useEffect)(function(){JSON.stringify(A)!==JSON.stringify(v.selectedTemplate)&&v.update({selectedTemplate:A,edtingTemplate:(0,O.ZN)(A)})},[JSON.stringify(A),v]),(0,m.useEffect)(function(){v.onChange||v.update({onChange:o})},[o]);var N=(0,m.useMemo)(function(){return{store:v}},[v]);return(0,i.jsx)(w.Qj,{children:function(){return(0,i.jsx)(z.Provider,{value:N,children:(0,i.jsxs)("div",{className:he()("react-client-print-container",{isEditing:v.mode==="edit"}),children:[(0,i.jsx)(Et,{}),(0,i.jsx)(Ue,{}),(0,i.jsx)(At,{})]})})}})},kt=(0,m.forwardRef)(function(s,t){return Lt(f()(f()({},s),{},{ref:t}))}),Rt=kt,It=function(t,e){var a=(0,w.fv)(t,e),n=(0,O.aD)(function(o){Object.assign(a,o)}),l=function(){return n(t())};return{store:a,updateStore:n,resetStore:l}},Gt=It,Se=JSON.parse('{"name":"\u9ED8\u8BA4\u6A21\u677F","size":{"type":"fixed","width":100,"height":100},"nodes":[{"id":"barcode","type":"barcode","placeholder":"{\u6761\u5F62\u7801}","top":290,"left":60,"width":254.1484375,"height":37.6484375},{"id":"qrcode","type":"qrcode","placeholder":"{\u4E8C\u7EF4\u7801}","top":50,"left":10,"width":90,"height":90},{"id":1598863711736,"type":"value","placeholder":"{\u5546\u54C1\u540D\u79F0}","top":50,"left":120,"fontSize":14,"height":32,"width":112,"style":{"fontWeight":"bold"}},{"id":1598863712603,"type":"value","placeholder":"{\u5546\u54C1\u5355\u4EF7}","top":100,"left":120,"fontSize":14,"height":32,"width":112},{"id":1598863713497,"type":"value","placeholder":"{\u5546\u54C1\u751F\u6210\u65E5\u671F}","top":0,"left":10,"fontSize":14,"height":34,"width":245.453125},{"id":1598863745684,"type":"value","placeholder":"{\u8BA2\u5355\u540D\u79F0}","top":160,"left":10,"fontSize":14,"height":34,"width":148.37890625,"style":{"fontWeight":"bold"}},{"id":1598863759434,"type":"value","placeholder":"{\u8BA2\u5355\u4E0B\u5355\u65E5\u671F}","top":200,"left":10,"fontSize":14,"height":36,"width":259.1875},{"id":1690622642526,"type":"value","placeholder":"{\u5BA2\u6237\u5730\u5740}","top":240,"left":160,"height":38,"width":216.3828125,"style":{"fontSize":14}},{"id":1690622708159,"type":"value","placeholder":"{\u6253\u5370\u65E5\u671F}","top":340,"left":130,"height":32,"width":112,"style":{"fontSize":14}},{"id":1690623498824,"type":"value","placeholder":"{\u5546\u54C1\u7C7B\u522B}","top":50,"left":250,"height":32,"width":112,"style":{"fontSize":14}},{"id":1690624022463,"type":"value","placeholder":"{\u5BA2\u6237\u540D\u79F0}","top":240,"left":10,"height":32,"width":112,"style":{"fontSize":14}},{"id":1690624155431,"type":"value","placeholder":"{\u8BA2\u5355\u7C7B\u578B}","top":160,"left":250,"height":32,"width":112,"style":{"fontSize":14}}],"style":{}}'),ae="react-client-print",de=function(){return JSON.parse(localStorage.getItem(ae)||"{}")},ue=function(){var t=de();return t.templates||[]},Ht=function(t){var e=de();localStorage.setItem(ae,JSON.stringify({templates:[].concat(_()(e.templates||[]),[f()(f()({},Se),t)]),defaultTemplateName:t==null?void 0:t.name}))},Jt=function(t){var e=ue();e=e.map(function(n){return n.name===(t==null?void 0:t.name)?t:n});var a={templates:e,defaultTemplateName:t==null?void 0:t.name};localStorage.setItem(ae,JSON.stringify(a))},Vt=function(t){var e,a,n=ue();n=n.filter(function(o){return o.name!==(t==null?void 0:t.name)});var l={templates:n,defaultTemplateName:(e=n)===null||e===void 0||(a=e[0])===null||a===void 0?void 0:a.name};localStorage.setItem(ae,JSON.stringify(l))},Wt=r(15623),ce=r.n(Wt),on=ce().mock({code:200,message:"success",data:{list:[],defaultTemplateName:function(){var t,e;return(t=this.list)===null||t===void 0||(e=t[0])===null||e===void 0?void 0:e.name}}}),Ut=ce().mock({code:200,message:"success",data:{"list|1-10":[{"id|+1":1,\u5546\u54C1\u540D\u79F0:"\u5546\u54C1\u540D\u79F0 @natural(10, 15)",\u5546\u54C1\u5355\u4EF7:"\u5546\u54C1\u5355\u4EF7 @natural(5000, 15000)",\u5546\u54C1\u7C7B\u522B:"\u5546\u54C1\u7C7B\u522B @natural(5, 15)",\u5546\u54C1\u751F\u6210\u65E5\u671F:'\u5546\u54C1\u751F\u6210\u65E5\u671F @datetime("yyyy-MM-dd")',\u8BA2\u5355\u540D\u79F0:"\u8BA2\u5355\u540D\u79F0 @word(8)",\u8BA2\u5355\u7C7B\u578B:"\u8BA2\u5355\u7C7B\u578B @word(6)",\u5BA2\u6237\u5730\u5740:"\u5BA2\u6237\u5730\u5740 @word(15)",\u5BA2\u6237\u540D\u79F0:"\u5BA2\u6237\u540D\u79F0 @word(4)",\u8BA2\u5355\u4E0B\u5355\u65E5\u671F:'\u8BA2\u5355\u4E0B\u5355\u65E5\u671F @datetime("yyyy-MM-dd HH:mm:ss")',\u6253\u5370\u65E5\u671F:'@datetime("yyyy-MM-dd")',\u6761\u5F62\u7801:"https://www.npmjs.com/package/jsbarcode",\u4E8C\u7EF4\u7801:"https://www.npmjs.com/package/qrcode"}]}}),Kt=ce().mock({code:200,message:"success",data:{"list|1-10":[{name:"\u81EA\u5B9A\u4E49\u5B57\u6BB5@natural(10, 100)","fields|1-6":["field @word(5)"]}]}}),Qt=function(){var s=D()(j()().mark(function t(){var e,a;return j()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=ue(),l.abrupt("return",{code:200,message:"success",data:{list:a,defaultTemplateName:(e=de())===null||e===void 0?void 0:e.defaultTemplateName}});case 2:case"end":return l.stop()}},t)}));return function(){return s.apply(this,arguments)}}(),Yt=function(){var s=D()(j()().mark(function t(e){return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return Ht(e),n.abrupt("return",{code:200,message:"success"});case 2:case"end":return n.stop()}},t)}));return function(e){return s.apply(this,arguments)}}(),Xt=function(){var s=D()(j()().mark(function t(e){return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return Jt(e),n.abrupt("return",{code:200,message:"success"});case 2:case"end":return n.stop()}},t)}));return function(e){return s.apply(this,arguments)}}(),qt=function(){var s=D()(j()().mark(function t(e){return j()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return Vt(e),n.abrupt("return",{code:200,message:"success"});case 2:case"end":return n.stop()}},t)}));return function(e){return s.apply(this,arguments)}}(),_t=function(){var s=D()(j()().mark(function t(){return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Ut);case 1:case"end":return a.stop()}},t)}));return function(){return s.apply(this,arguments)}}(),en=function(){var s=D()(j()().mark(function t(){return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Kt);case 1:case"end":return a.stop()}},t)}));return function(){return s.apply(this,arguments)}}(),tn=[{name:"\u5546\u54C1\u4FE1\u606F",fields:["\u5546\u54C1\u540D\u79F0","\u5546\u54C1\u7C7B\u522B","\u5546\u54C1\u5355\u4EF7","\u5546\u54C1\u751F\u6210\u65E5\u671F"]},{name:"\u8BA2\u5355\u4FE1\u606F",fields:["\u8BA2\u5355\u540D\u79F0","\u8BA2\u5355\u7C7B\u578B","\u8BA2\u5355\u4E0B\u5355\u65E5\u671F","\u5BA2\u6237\u5730\u5740","\u5BA2\u6237\u540D\u79F0"]},{name:"\u5176\u4ED6\u4FE1\u606F",fields:["\u6253\u5370\u65E5\u671F","\u4E8C\u7EF4\u7801","\u6761\u5F62\u7801"]}],nn=function(){var t=(0,m.useRef)(null),e=(0,m.useRef)(0),a=Gt(function(){return{templates:[],defaultTemplateName:void 0,dataSource:[],defaultFields:tn}}),n=a.store,l=a.updateStore,o=(0,fe.Z)(function(){return Qt()},{manual:!0,onSuccess:function(x){if(x.code===200){var S,p;l({templates:(S=x.data)===null||S===void 0?void 0:S.list,defaultTemplateName:(p=x.data)===null||p===void 0?void 0:p.defaultTemplateName})}}}),d=o.loading,v=o.run,A=(0,fe.Z)(function(){return _t()},{manual:!0,onSuccess:function(x){if(x.code===200){var S;l({dataSource:(S=x.data)===null||S===void 0?void 0:S.list})}}}),N=A.loading,B=A.run,g=function(){v(),B()};return(0,m.useEffect)(function(){g(),setTimeout(function(){var T;if(!((T=n.templates)!==null&&T!==void 0&&T.length)&&!e.current){var x;(x=t.current)===null||x===void 0||x.store.createTemplate(f()({},Se)),e.current=1}},2e3)},[]),(0,m.useEffect)(function(){var T=function(){var x=D()(j()().mark(function S(){var p,b;return j()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,en();case 2:p=y.sent,p.code===200&&l({defaultFields:[].concat(_()(n.defaultFields),_()(((b=p.data)===null||b===void 0?void 0:b.list)||[]))});case 4:case"end":return y.stop()}},S)}));return function(){return x.apply(this,arguments)}}();T()},[]),(0,i.jsx)(Pe.Z,{spinning:d||N,children:(0,i.jsx)("div",{className:"tag-editor-container",children:(0,i.jsx)(Rt,{ref:t,templates:n.templates,defaultTemplateName:n.defaultTemplateName,dataSource:n.dataSource,defaultFields:n.defaultFields,onChange:function(){var T=D()(j()().mark(function x(S){var p,b,M,y,u;return j()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(p=S.template,b=S.operationType,b!=="create"){C.next=6;break}return C.next=4,Yt(p);case 4:M=C.sent,M.code===200&&ee.ZP.success("\u65B0\u5EFA\u6A21\u677F\u6210\u529F");case 6:if(b!=="update"){C.next=11;break}return C.next=9,Xt(p);case 9:y=C.sent,y.code===200&&ee.ZP.success("\u4FEE\u6539\u6A21\u677F\u6210\u529F");case 11:if(b!=="delete"){C.next=16;break}return C.next=14,qt(p);case 14:u=C.sent,u.code===200&&ee.ZP.success("\u5220\u9664\u6A21\u677F\u6210\u529F");case 16:g();case 17:case"end":return C.stop()}},x)}));return function(x){return T.apply(this,arguments)}}()})})})},an=(0,w.Pi)(nn)}}]);
